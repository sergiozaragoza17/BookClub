{% extends 'base.html.twig' %}

{% block title %}Club{% endblock %}

{% block body %}
    <h1 class="mt-3 text-center">{{ club.name }}</h1>
    <div class="container border mt-3 p-3">
        <div class="description">
            <h3>Description: </h3>
            <p>{{ club.description }}</p>
        </div>
        <div class="genre">
            <h3>Club Genre:</h3>
            <p>{{ club.genre.name }}</p>
        </div>
        <hr>
        <h1>Club books</h1>
        <div class="d-flex flex-wrap gap-3 mb-3" style="margin-left: 2%">
            {% for clubBook in clubBooks %}
                <div class="card d-inline-block" style="width: auto;">
                    <a href="{{ path('book_show', {'id' : clubBook.book.id}) }}">
                        <img src="{{ clubBook.book.coverImage }}" alt="{{ clubBook.book.title }}" class="book-cover">
                    </a>
                    <div class="card-body p-2" style="width: 300px;">
                        <h5 class="card-title book-card-title">{{ clubBook.book.title }}</h5>
                        <div class="mt-2 d-flex justify-content-between">
                            <a class="btn btn-outline-warning btn-sm" href="{{ path('club_book_forum', {'book': clubBook.book.id, 'club' : clubBook.club.id}) }}">Forum</a>
                            {% if club.createdBy == app.user or is_granted('ROLE_ADMIN') %}
                                <form method="post"
                                      action="{{ path('club_book_remove', {'book': clubBook.book.id, 'club' : clubBook.club.id}) }}"
                                      style="display:inline;"
                                      data-confirm="Are you sure you want to remove {{ clubBook.book.title|e('html_attr') }} from this club?"
                                      data-confirm-title="Remove from club"
                                      data-confirm-action="delete">
                                    <input type="hidden" name="_token" value="{{ csrf_token('remove_book' ~ clubBook.id) }}">
                                    <button class="btn btn-outline-danger btn-sm">Remove Book</button>
                                </form>
                            {% endif %}
                        </div>
                    </div>
                </div>
            {% else %}
                <p>No books added yet.</p>
            {% endfor %}
        </div>
    </div>
    <div class="container mt-3 mb-3 d-flex justify-content-between align-items-center">
        <div class="firstButtonBlock">
            <button class="btn btn-outline-info" onclick="window.history.back();">Back</button>
            <a class="btn btn-outline-warning" href="{{ path('club_forum', {'club' : club.id}) }}">general forum</a>
            <a class="btn btn-info" href="{{ path('club_add_book', {'id' : club.id}) }}">add books</a>
        </div>
        <div class="secondButtonBlock d-flex gap-2 ">

            {% if app.user %}
                {% if club.members.contains(app.user) %}
                    <form method="post" action="{{ path('club_leave', {id: club.id}) }}">
                        <button type="submit" class="btn btn-outline-danger">Leave club</button>
                    </form>
                {% else %}
                    {% if not is_granted('ROLE_ADMIN') %}
                        <form method="post" action="{{ path('club_join', {id: club.id}) }}">
                            <button type="submit" class="btn btn-outline-success">Join club</button>
                        </form>
                    {% endif %}
                {% endif %}
            {% endif %}
            {% if club.createdBy == app.user or is_granted('ROLE_ADMIN') %}
                <a class="btn btn-secondary" href="{{ path('club_edit', {'id': club.id}) }}">edit</a>
                {{ include('club/_delete_form.html.twig') }}
            {% endif %}
        </div>
    </div>
{% endblock %}
